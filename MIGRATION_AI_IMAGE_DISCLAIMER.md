# Database Migration: Add AI Image Disclaimer Support

## Overview
This migration adds support for tracking whether menu item images were generated by AI, enabling display of a disclaimer to users.

## Schema Changes

### Image Model
Added `isAiGenerated` field to track AI-generated images.

## SQL Migration

Run the following SQL command on your database:

```sql
-- Add isAiGenerated column to Image table
ALTER TABLE "Image" ADD COLUMN "isAiGenerated" BOOLEAN NOT NULL DEFAULT false;
```

## Alternative: Prisma Migration

If you have DATABASE_URL configured, you can use Prisma to generate and run the migration:

```bash
npx prisma migrate dev --name add_is_ai_generated_to_image
```

## After Migration

1. Regenerate Prisma Client:
```bash
npx prisma generate
```

2. The application will now:
   - Track which images were generated by AI
   - Display disclaimer "AI-generated image - actual dish may vary" on menu items with AI images
   - Show disclaimer in both MenuItemCard and ViewMenuItemModal components

## Files Modified

- `prisma/schema.prisma` - Added `isAiGenerated Boolean @default(false)` to Image model
- `src/utils/validators.ts` - Added `isAiGeneratedImage` to menuItemInputBase
- `src/components/Forms/MenuItemForm.tsx` - Track and set AI generation flag
- `src/server/api/routers/menuItem.router.ts` - Store isAiGenerated when creating images
- `src/server/services/translation.service.ts` - Added `getImageDisclaimer()` function for automatic translation
- `src/server/api/routers/restaurant.router.ts` - Attach translated disclaimers to menu items
- `src/components/RestaurantMenu/ViewMenuItemModal.tsx` - Display translated disclaimer from API
- `src/components/RestaurantMenu/MenuItemCard.tsx` - Display translated disclaimer from API

## Disclaimer Behavior

**All menu item images now display automatically translated disclaimers:**
- **AI-generated images**: "Imagem gerada por IA - o prato real pode variar" (Portuguese source)
- **Manually uploaded images**: "A apresentação real pode variar" (Portuguese source)

The disclaimers are automatically translated via DeepL (same as menu content), ensuring they appear in the correct language for all supported languages.

## Automatic Translation

Disclaimers are translated server-side using DeepL API:
- Source language: Portuguese (PT)
- Target languages: All DeepL-supported languages (EN, ES, FR, DE, IT, NL, PL, RU, JA, ZH, etc.)
- Caching: Translations cached in database (Translation table)
- No manual translation files needed

See `AUTOMATIC_TRANSLATION_DISCLAIMERS.md` for complete implementation details.

## Testing

After migration:
1. **Test AI-generated image**:
   - Generate an image using AI for a menu item
   - Save the menu item
   - View the menu item in both card and modal views
   - Verify the disclaimer appears: "AI-generated image - actual dish may vary"

2. **Test manually uploaded image**:
   - Upload an image via drag & drop for a menu item
   - Save the menu item
   - View the menu item in both card and modal views
   - Verify the disclaimer appears: "Actual presentation may vary"

3. **Verify all images show disclaimers**: Both AI and manual images should display disclaimers (with different messages)
